<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gap Finder - Text-to-Speech Component</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .speech-highlight {
            background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .reading-mode {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <!-- Text-to-Speech Control Panel -->
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
                </svg>
                Accessibility Reader
            </h2>
            
            <!-- Control Bar -->
            <div class="flex flex-wrap gap-3 mb-4">
                <button id="playBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                    </svg>
                    Play
                </button>
                
                <button id="pauseBtn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-2 hidden">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    Pause
                </button>
                
                <button id="stopBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                    </svg>
                    Stop
                </button>
                
                <!-- Speed Control -->
                <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-600">Speed:</label>
                    <select id="speedControl" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
                
                <!-- Voice Selection -->
                <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-600">Voice:</label>
                    <select id="voiceSelect" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <!-- Populated dynamically -->
                    </select>
                </div>
                
                <!-- Reading Mode Toggle -->
                <button id="readingModeBtn" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                    </svg>
                    Reading Mode
                </button>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <!-- Status Display -->
            <div id="statusDisplay" class="text-sm text-gray-600">
                Ready to read content
            </div>
        </div>
        
        <!-- Sample Content to Read -->
        <div id="contentArea" class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4 readable-content">Canva - Gap Analysis</h3>
            
            <div class="space-y-4">
                <div class="readable-content">
                    <h4 class="font-semibold text-gray-700 mb-2">Top User Complaints:</h4>
                    <ul class="space-y-2">
                        <li class="flex items-start gap-2">
                            <span class="text-xs px-2 py-1 bg-red-50 text-red-700 rounded-full">34%</span>
                            <span class="text-sm text-gray-600">Too slow and heavy loading times</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-xs px-2 py-1 bg-yellow-50 text-yellow-700 rounded-full">28%</span>
                            <span class="text-sm text-gray-600">No offline access capability</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-xs px-2 py-1 bg-green-50 text-green-700 rounded-full">22%</span>
                            <span class="text-sm text-gray-600">Limited customization for advanced users</span>
                        </li>
                    </ul>
                </div>
                
                <div class="readable-content p-4 bg-green-50 rounded-lg">
                    <h4 class="font-semibold text-green-700 mb-1">ðŸ’¡ Top Opportunity:</h4>
                    <p class="text-sm text-green-600">
                        Universal Offline Support - ALL major design tools require internet. 
                        This is the number one complaint across ALL design tools. 
                        A truly offline-first design tool could capture significant market share.
                    </p>
                </div>
                
                <div class="readable-content">
                    <h4 class="font-semibold text-gray-700 mb-2">Action Strategy:</h4>
                    <p class="text-sm text-gray-600">
                        Position as "The 5-Second Canva" - make speed your core differentiator. 
                        34% of users complain about slow loading. Speed equals competitive advantage.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Keyboard Shortcuts Info -->
        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
            <h4 class="font-semibold text-blue-900 mb-2">Keyboard Shortcuts:</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-blue-700">
                <div><kbd class="px-2 py-1 bg-white rounded">Space</kbd> Play/Pause</div>
                <div><kbd class="px-2 py-1 bg-white rounded">Esc</kbd> Stop</div>
                <div><kbd class="px-2 py-1 bg-white rounded">â†‘</kbd> Speed Up</div>
                <div><kbd class="px-2 py-1 bg-white rounded">â†“</kbd> Speed Down</div>
            </div>
        </div>
    </div>
    
    <script>
        // Text-to-Speech Manager
        class TextToSpeechManager {
            constructor() {
                this.synth = window.speechSynthesis;
                this.currentUtterance = null;
                this.isPaused = false;
                this.isReading = false;
                this.readingMode = false;
                this.currentIndex = 0;
                this.contentElements = [];
                
                this.initializeControls();
                this.loadVoices();
                this.setupKeyboardShortcuts();
            }
            
            initializeControls() {
                // Button controls
                this.playBtn = document.getElementById('playBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.speedControl = document.getElementById('speedControl');
                this.voiceSelect = document.getElementById('voiceSelect');
                this.readingModeBtn = document.getElementById('readingModeBtn');
                this.progressBar = document.getElementById('progressBar');
                this.statusDisplay = document.getElementById('statusDisplay');
                this.contentArea = document.getElementById('contentArea');
                
                // Event listeners
                this.playBtn.addEventListener('click', () => this.play());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.stopBtn.addEventListener('click', () => this.stop());
                this.speedControl.addEventListener('change', () => this.updateSpeed());
                this.voiceSelect.addEventListener('change', () => this.updateVoice());
                this.readingModeBtn.addEventListener('click', () => this.toggleReadingMode());
            }
            
            loadVoices() {
                const voices = this.synth.getVoices();
                const englishVoices = voices.filter(voice => voice.lang.startsWith('en'));
                
                this.voiceSelect.innerHTML = '';
                englishVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (voice.default) option.selected = true;
                    this.voiceSelect.appendChild(option);
                });
                
                // Reload voices when they change
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => this.loadVoices();
                }
            }
            
            play() {
                if (this.isPaused) {
                    this.synth.resume();
                    this.isPaused = false;
                    this.updateStatus('Resumed reading');
                } else {
                    this.startReading();
                }
                
                this.playBtn.classList.add('hidden');
                this.pauseBtn.classList.remove('hidden');
            }
            
            pause() {
                if (this.isReading) {
                    this.synth.pause();
                    this.isPaused = true;
                    this.updateStatus('Paused');
                    
                    this.playBtn.classList.remove('hidden');
                    this.pauseBtn.classList.add('hidden');
                }
            }
            
            stop() {
                this.synth.cancel();
                this.isReading = false;
                this.isPaused = false;
                this.currentIndex = 0;
                this.updateProgress(0);
                this.updateStatus('Stopped');
                this.clearHighlights();
                
                this.playBtn.classList.remove('hidden');
                this.pauseBtn.classList.add('hidden');
            }
            
            startReading() {
                // Get all readable content
                this.contentElements = Array.from(
                    this.contentArea.querySelectorAll('.readable-content, h3, h4, p, li span:last-child')
                );
                
                if (this.contentElements.length === 0) {
                    this.updateStatus('No content to read');
                    return;
                }
                
                this.isReading = true;
                this.readNext();
            }
            
            readNext() {
                if (this.currentIndex >= this.contentElements.length) {
                    this.stop();
                    this.updateStatus('Finished reading');
                    return;
                }
                
                const element = this.contentElements[this.currentIndex];
                const text = element.textContent.trim();
                
                if (!text) {
                    this.currentIndex++;
                    this.readNext();
                    return;
                }
                
                // Highlight current element
                this.clearHighlights();
                element.classList.add('speech-highlight');
                if (this.readingMode) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                // Create utterance
                this.currentUtterance = new SpeechSynthesisUtterance(text);
                this.currentUtterance.rate = parseFloat(this.speedControl.value);
                
                // Set voice
                const selectedVoice = this.voiceSelect.value;
                const voices = this.synth.getVoices();
                const voice = voices.find(v => v.name === selectedVoice);
                if (voice) this.currentUtterance.voice = voice;
                
                // Set up event handlers
                this.currentUtterance.onend = () => {
                    this.currentIndex++;
                    this.updateProgress((this.currentIndex / this.contentElements.length) * 100);
                    if (this.isReading) {
                        this.readNext();
                    }
                };
                
                this.currentUtterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    this.updateStatus('Error reading content');
                };
                
                // Start speaking
                this.synth.speak(this.currentUtterance);
                this.updateStatus(`Reading: ${text.substring(0, 50)}...`);
            }
            
            updateSpeed() {
                if (this.currentUtterance) {
                    // Stop and restart with new speed
                    const wasReading = this.isReading;
                    this.stop();
                    if (wasReading) {
                        setTimeout(() => this.play(), 100);
                    }
                }
            }
            
            updateVoice() {
                if (this.currentUtterance) {
                    // Stop and restart with new voice
                    const wasReading = this.isReading;
                    this.stop();
                    if (wasReading) {
                        setTimeout(() => this.play(), 100);
                    }
                }
            }
            
            toggleReadingMode() {
                this.readingMode = !this.readingMode;
                
                if (this.readingMode) {
                    this.contentArea.classList.add('reading-mode');
                    this.readingModeBtn.classList.add('bg-yellow-600');
                    this.updateStatus('Reading mode enabled - content will auto-scroll');
                } else {
                    this.contentArea.classList.remove('reading-mode');
                    this.readingModeBtn.classList.remove('bg-yellow-600');
                    this.updateStatus('Reading mode disabled');
                }
            }
            
            clearHighlights() {
                document.querySelectorAll('.speech-highlight').forEach(el => {
                    el.classList.remove('speech-highlight');
                });
            }
            
            updateProgress(percentage) {
                this.progressBar.style.width = `${percentage}%`;
            }
            
            updateStatus(message) {
                this.statusDisplay.textContent = message;
            }
            
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Space bar - Play/Pause
                    if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                        e.preventDefault();
                        if (this.isReading && !this.isPaused) {
                            this.pause();
                        } else {
                            this.play();
                        }
                    }
                    
                    // Escape - Stop
                    if (e.code === 'Escape') {
                        this.stop();
                    }
                    
                    // Arrow Up - Speed up
                    if (e.code === 'ArrowUp' && e.ctrlKey) {
                        e.preventDefault();
                        const currentSpeed = parseFloat(this.speedControl.value);
                        if (currentSpeed < 2) {
                            this.speedControl.value = Math.min(2, currentSpeed + 0.25);
                            this.updateSpeed();
                        }
                    }
                    
                    // Arrow Down - Speed down
                    if (e.code === 'ArrowDown' && e.ctrlKey) {
                        e.preventDefault();
                        const currentSpeed = parseFloat(this.speedControl.value);
                        if (currentSpeed > 0.5) {
                            this.speedControl.value = Math.max(0.5, currentSpeed - 0.25);
                            this.updateSpeed();
                        }
                    }
                });
            }
        }
        
        // Initialize when page loads
        const ttsManager = new TextToSpeechManager();
        
        // Make available globally for integration
        window.gapFinderTTS = ttsManager;
    </script>
</body>
</html>